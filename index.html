<html>
  <head>
    <title>Woodpecker [KMUTNB]</title>

    <!-- Css pure -->
    <link href="./dist/css/home.css" rel="stylesheet" />
    <!-- Front Google -->
    <link
      href="https://fonts.googleapis.com/css?family=Kanit:400&display=swap"
      rel="stylesheet"
    />
    <!-- Css Bootstap -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <!-- Title / Header -->
    <p class="title_header">Woodpecker [KMUTNB]</p>
    <!-- Select -->
    <div class="container">
      <div class="left_container">
        <select class="custom-select dropdown_style">
          <option selected value="l0">เลือกเขตที่คุณต้องการ</option>
          <option value="l1">เขต 1</option>
        </select>

        <select
          class="custom-select dropdown_id dropdown_style"
          onchange="getChangeLoc()"
        >
          <option selected value="Loc0">เลือกสถานีสูบน้ำ</option>
          <option value="Loc1">สถานี 1</option>
          <option value="Loc2">สถานี 2</option>
          <!-- <option value="Loc3">สถานี 3</option>
          <option value="Loc4">สถานี 4</option> -->
        </select>
        <!-- Display -->
        <div class="wrap_show_data">
          <p id="topic_water_level">ระดับน้ำในปัจจุบัน</p>
          <p id="data_water_level">0</p>
          <div class="inline_content_i">
            <p id="topic_timing">เวลา :&nbsp;</p>
            <p id="data_timing">0/0/0</p>
          </div>
          <br />
          <div class="inline_content_ii">
            <p id="data_situation">สถานการณ์ :&nbsp;</p>
            <p id="data_situation_green" class="situation">ปกติ</p>
          </div>
        </div>
      </div>
      <div class="right_container">
        <span>
          <p class="topic_future">ข้อมูลน้ำในอนาคต</p>
          <span class="date_rel">
            <p>อัพเดท</p>
            <p id="Time">--/--/----</p>
          </span>
        </span>
        <span>
          <p>ฝน :&nbsp;</p>
          <p id="rain"></p>
        </span>
        <span>
          <p>ปริมาณน้ำฝน :&nbsp;</p>
          <p id="quantity_predic"></p>
        </span>
        <span>
          <p>ระดับน้ำสูงสุดของสถานี :&nbsp;</p>
          <p id="max_water"></p>
        </span>
        <span>
          <p>ระดับน้ำที่คาดว่าจะเพิ่ม :&nbsp;</p>
          <p id="level_predic"></p>
        </span>
        <span>
          <p>สรุปสถานการณ์น้ำในอนาคต :&nbsp;</p>
          <p id="situation_predic"></p>
        </span>
        <span>
          <p>ปริมาณน้ำที่เกิน :&nbsp;</p>
          <p id="wateroutage_pred"></p>
        </span>
      </div>
    </div>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

    <!-- Optional JavaScript Import-->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script>
      var baseLevelWater = 100;
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyBxLjHKPM_eOxYGO5aJwg2svvwlzi_LeLQ",
        authDomain: "testdb1-c492c.firebaseapp.com",
        databaseURL: "https://testdb1-c492c.firebaseio.com",
        projectId: "testdb1-c492c",
        storageBucket: "testdb1-c492c.appspot.com",
        messagingSenderId: "426623306115",
        appId: "1:426623306115:web:92108ed015015086"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var database = firebase.database();

      var getChangeLoc = () => {
        database
          .ref(
            `Location/` +
              $("select.dropdown_id")
                .children("option:selected")
                .val()
          )
          .orderByChild(`Current`)
          .on("value", function(snapshot) {
            console.log(snapshot.val());
            snapshot.forEach(function(data) {
              // Condition for ignore trigger old method
              // if (data.key == "Current")
              if (
                snapshot.key.toString().replace("Location", "") ==
                $("select.dropdown_id")
                  .children("option:selected")
                  .val()
              ) {
                if (data.key == "Current") {
                  var childData = data.val();
                  // Set value to display
                  $("#data_water_level").text(childData["level"]);
                  $("#data_timing").text(childData["Time"]);

                  if (Number(childData["level"]) >= baseLevelWater) {
                    $(".situation")
                      .text("มีโอกาสเกิดน้ำท่วม")
                      .css("color", "red");
                  } else {
                    $(".situation")
                      .text("ปกติ")
                      .css("color", "green");
                  }
                } else if (data.key == "AreaDat") {
                  var childData = data.val();
                  console.log(childData);
                  Object.keys(childData).map(function(key, index) {
                    if (key == "situation_predic") {
                      if (childData[key] == "0") $("#" + key).text("ปกติ");
                      else $("#" + key).text("มีโอกาสเกิดน้ำท่วม");
                    } else {
                      $("#" + key).text(childData[key]);
                    }
                  });
                  // childData.map(key => {

                  // });
                }
              }
            });
          });
      };
    </script>
  </body>
</html>
